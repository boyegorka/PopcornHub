<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="templatemo">
    <title>{% block title %}PopcornHub{% endblock %}</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

    {% load static %}
    <!-- Bootstrap core CSS -->
    <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">

    <!-- Additional CSS Files -->
    <link href="{% static 'assets/css/fontawesome.css' %}" rel="stylesheet">
    <link href="{% static 'assets/css/templatemo-snapx-photography.css' %}" rel="stylesheet">
    <link href="{% static 'assets/css/owl.css' %}" rel="stylesheet">
    <link href="{% static 'assets/css/animate.css' %}" rel="stylesheet">
    <link href="{% static 'assets/css/swiper-bundle.min.css' %}" rel="stylesheet">
</head>
<body>
    {% include 'includes/navbar.html' %}
    
    <main>
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
        
        {% block content %}
        <!-- В навигационном меню -->
        {% if user.is_staff %}
            <li class="nav-item">
                <a class="nav-link" href="{% url 'showcase:movie-stats' %}">
                    Статистика фильмов
                </a>
            </li>
        {% endif %}
        {% endblock %}
    </main>

    {% include 'includes/footer.html' %}

    <!-- Scripts -->
    <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'vendor/bootstrap/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'assets/js/isotope.min.js' %}"></script>
    <script src="{% static 'assets/js/owl-carousel.js' %}"></script>
    <script src="{% static 'assets/js/tabs.js' %}"></script>
    <script src="{% static 'assets/js/popup.js' %}"></script>
    <script src="{% static 'assets/js/custom.js' %}"></script>

    <script>
    function updateBanner(movieElement) {
        // Обновляем фоновое изображение из постера фильма
        const posterImg = movieElement.querySelector('.thumb img');
        if (posterImg && posterImg.src) {
            const mainBanner = document.querySelector('.main-banner');
            mainBanner.style.backgroundImage = `url('${posterImg.src}')`;
            console.log("Updating banner image to:", posterImg.src);
        }

        // Обновляем информацию в баннере
        const title = movieElement.querySelector('.content h4').textContent;
        const description = movieElement.querySelector('.content ul').innerHTML;
        const rating = movieElement.querySelector('.content .rating').innerHTML;

        document.querySelector('.main-banner .header-text h2').innerHTML = title;
        document.querySelector('.main-banner .movie-info').innerHTML = description;
        document.querySelector('.main-banner .rating-display').innerHTML = rating;
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Используем конкретный id карусели
        const topRatedCarousel = document.getElementById('topRatedCarousel');
        if (!topRatedCarousel) return;

        // Инициализация для первого слайда
        const firstSlide = topRatedCarousel.querySelector('.item');
        if (firstSlide) {
            updateBanner(firstSlide);
        }

        // Обновление при смене слайда в карусели
        $('#topRatedCarousel').on('translated.owl.carousel', function(event) {
            const currentSlide = $(event.target).find('.owl-item.active').first().find('.item');
            if (currentSlide.length) {
                updateBanner(currentSlide[0]);
            }
        });
    });
    </script>
</body>
</html>