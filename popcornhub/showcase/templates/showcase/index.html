{% extends 'base.html' %}
{% load static %}
{% load movie_filters %}
{% load movie_tags %}

{% block content %}
    <!-- Main Banner Area -->
    <div class="main-banner">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 offset-lg-1">
                    <div class="header-text">
                        <h2>Обязательно посмотрите</h2>
                        <div class="rating-display"></div>
                        <div class="movie-info"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Featured Movies Section -->
    {% show_featured_movies %}

    <!-- Current Movies Section -->
    {% show_current_movies %}

    <!-- Upcoming Movies Section -->
    {% show_upcoming_movies %}

    <!-- Streaming Services Section -->
    {% show_streaming_services %}
{% endblock %}

{% block sidebar %}
    {% show_genres_sidebar %}
{% endblock %}

{% block extra_js %}
<script>
function updateBanner(movieElement) {
    if (!movieElement) return;
    
    const movieId = movieElement.dataset.movieId;
    console.log('Updating banner for movie ID:', movieId);
    
    // Обновляем фоновое изображение
    const posterImg = movieElement.querySelector('.thumb img');
    if (posterImg && posterImg.src) {
        const mainBanner = document.querySelector('.main-banner');
        mainBanner.style.backgroundImage = `url('${posterImg.src}')`;
        mainBanner.style.backgroundSize = 'cover';
        mainBanner.style.backgroundPosition = 'center';
        mainBanner.style.height = '600px';
    }

    // Обновляем информацию
    const title = movieElement.querySelector('.content h4')?.textContent;
    const description = movieElement.querySelector('.content ul')?.innerHTML;
    const rating = movieElement.querySelector('.content .rating')?.innerHTML;

    const headerText = document.querySelector('.main-banner .header-text h2');
    const movieInfo = document.querySelector('.main-banner .movie-info');
    const ratingDisplay = document.querySelector('.main-banner .rating-display');

    if (headerText && title) headerText.innerHTML = title;
    if (movieInfo && description) movieInfo.innerHTML = description;
    if (ratingDisplay && rating) ratingDisplay.innerHTML = rating;
}

document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('.owl-features');
    if (carousel) {
        // Ждем инициализацию карусели
        setTimeout(() => {
            const activeSlide = carousel.querySelector('.owl-item.active .item');
            if (activeSlide) {
                updateBanner(activeSlide);
            }
        }, 100);

        // Обновляем при смене слайда
        carousel.addEventListener('translated.owl.carousel', function(event) {
            const activeSlide = carousel.querySelector('.owl-item.active .item');
            if (activeSlide) {
                updateBanner(activeSlide);
            }
        });
    }
});
</script>
{% endblock %}

<style>
.main-banner {
    position: relative;
    height: 600px;
    background-size: cover;
    background-position: center;
    transition: background-image 0.3s ease-in-out;
}

.main-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
}

.main-banner .container {
    position: relative;
    z-index: 1;
    height: 100%;
    display: flex;
    align-items: center;
}

.header-text {
    color: #fff;
}

.header-text h2 {
    color: #fff;
    font-size: 48px;
    margin-bottom: 20px;
}

.movie-info {
    color: #fff;
    font-size: 18px;
}

.rating-display {
    margin: 15px 0;
    font-size: 24px;
}

.actors-section {
    height: 100%;
    display: flex;
    flex-direction: column;
}

.actors-info {
    flex: 1;
}

.actor-item {
    padding: 8px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.actor-item:last-child {
    border-bottom: none;
}

.actors-grid .actor-item {
    padding: 10px;
    margin-bottom: 15px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    transition: all 0.3s ease;
}

.actors-grid .actor-item:hover {
    background: rgba(255, 255, 255, 0.2);
}

.actor-name {
    color: #fff;
    font-size: 16px;
    margin: 0;
}
</style>